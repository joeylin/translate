<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
        <title>MPush</title>
        <meta name="generator" content="MPush" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
        <!-- bootstrap 3.0.2 -->
        <link href="/public/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <!-- font Awesome -->
        <link href="/public/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <!-- Theme style -->
        <link href="/public/css/AdminLTE.css" rel="stylesheet" type="text/css" />

        <!--[if lt IE 9]>
          <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- CSS code from MPush.com editor -->
        
        <style type="text/css">
          body,html,.navbar-header {
            background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAYCAYAAACIhL/AAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYUlEQVRIx42WYXLrIAyEBSb3v2OvkSDen7f0y0Y49UynDgYhrVYrtZ+fn/V4PGLOGRERa62IiGitvb231iIiIjOj9x561lp7X+89MnN/u64r1lqRmduGzmdmrLU+9tBG7z2GLtbh6llrbQf5+H5dquB0sd61npn7rILzgLV/aKMi0EME3RAdI8qOtlDQhUJHSDFwrdFGay0GI9fFfknl8LfnFNzdQ7B0ZtAB8eGEDh11jlZpYhr5V9kmt2lvcMENeOReHNzHb478af0vyA6mt0or14jc6eLqvPaLg6ziKjCeGadUni4k0Yksif8NvdN3nt9Fcl3X5h61Sr+pSSQytU+/SW79JkKUlznnm4PSYZerUZHXUWCqvUDudJKBZGaMMW5VgpKzOajUXNf1Idgu3lWXYdSy4YGJa6eiqFIrv8acM+ac8Xq9ynbl6MhpBuHSUfGaSHphsNu4QgwS3KXEHaTjXs3uCB1iMN/aKB3NzF+ZqdqZizFTQSNe4XSGRVS1sqo1EuXRe/+oUKFadRDXNBdxn1oqLSVyfocjO06OONycRIiKf6c88V1VrMx4/2eVv3FwzhnP57M8SEc8TZVznlpRQo55toSwayrtvKWYhNXhSvkpH3ekp8ZS4KvZs+L/fz96OY146Z8qrRJ2rv91xuQgy/tHNeY44St99JQzbacJR9+47u8e0HDBJNkrOakEmkZPE/paazcETtP6z16sPt1ai04dvOPEtzGsCqripTgvqar6L9f2NMMq8wnmrtq8q9C4pqQq5U4daibRHyQn+Xjqx3d9+jRtnzLknclRbK3FP3PnY9UL0WZ9AAAAAElFTkSuQmCC) repeat fixed;
          }
          .nav-tabs-custom, 
          .nav-tabs-custom > .tab-content {
            background-color: transparent;
          }
          .navbar {
            border: none;
          }
          .navbar .navbar-header {
            height: 86px;
            background-color: #fff;
            width: 252px;
          }
          .navbar {
            background-color: #101010;
          }
          .navbar .navbar-header a {
            line-height: 56px;
            font-size: 32px;
            color: rgb(51, 51, 51);
            width: 100%;
            text-align: center;
          }
          .subTile {
            color: #f9f9f9;
            font-size: 18px;
            line-height: 86px;
            padding-left: 15px;
          }
          .form-inline {
            line-height: 84px;
          }
          .form-inline > .form-group {
            margin-right: 5px;
          }
          .signUpContainer {
            margin-top: 60px;
            margin-bottom: 60px;
          }
          .nav-tabs-custom {
            box-shadow: none;
          }
          .signupTab > h3 {
            position: relative;
            left: -13px;
            color: #008d4c;
            font-size: 20px;
          }
          .signupTab .nav-tabs>li>a {
            border: 0;
            font-size: 18px;
          }
          .signupTab > .nav-tabs > li {
            border-top: 0;
            border-bottom: 3px solid transparent;
          }
          .signupTab > .nav-tabs > li.active {
            border-bottom-color: #3c8dbc;
          }
          .signupTab > .nav-tabs {
            border-bottom-color: transparent;
          }
          .signupTab .nav-tabs>li.active>a:hover {
            border: 0;
          }
          .signupTab .tab-content {
            margin-top: 25px;
          }
          .signupTab .tab-content label {
            line-height: 37px;
            width: 100%;
            text-align: right;
            font-weight: 400;
          }
          .signupTab .tab-pane form > div {
            margin-bottom: 15px;
          }
          .signupTab label.error {
            position: absolute;
            top: -31px;
            left: 28px;
            color: red;
            text-align: left; 
            font-size: 13px;
          }
          .signUpContainer .promoteContainer {
            padding-left: 30px;
            height: 402px;
            overflow: hidden;
          }
          .signupFooter {
            position: relative;
          }
          .signupFooter label.error {
            position: relative;
            top: 4px;
            left: 0;
            line-height: 27px;
            float: right;
            display: inline-block;
            width: inherit;
            margin-right: 10px;
          }
          .pageFooter {
            height: 86px;
          }
          .pageFooter p {
            width: 100%;
          }
          .subTile {
            color: #999;
            margin-left: 15px;
          }
          /*reset style*/
          .navbar {
             border-radius: 0; 
          }
          .form-control {
            -webkit-border-radius: 4px !important; 
            -moz-border-radius: 4px !important;
            border-radius: 4px !important; 
          }
          .iradio_minimal {
            margin-right: 5px;
            -webkit-border-radius: 10px; 
            -moz-border-radius: 10px;
            border-radius: 10px; 
          }
          .form-group .radio {
            margin-bottom: 0;
            margin-top: 0;
          }
          input.error:focus {
            border-color: red!important;
          }
          .form-inline .form-group {
            position: relative;
          }
          .form-inline .form-group .tip {
            position: absolute;
            top: -29px;
            left: 0;
            color: red;
            font-size: 13px;
            display: none;
            height: 14px;
          }
          .findPassword {
            color: #929292;
            font-size: 13px;
            position: absolute;
            bottom: 30px;
            right: -84px;
            display: inline-block;
            line-height: 20px;
          }

          /* footer */
          footer {
            border-top: 1px solid #E0E0E0;
            padding: 10px 0;
            text-align: left;
            background: #f9f9f9;
            color: #999;
          }
        </style>
        
    </head>
    
    <!-- HTML code from Bootply.com editor -->   
    <body>   
        <nav class="navbar" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <a class="navbar-brand" href="#">Mpush 多推</a>
            </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav navbar-right">
                <li>
                  <form class="form-inline" role="form" id="formLogin">
                    <div class="form-group">
                      <input type="email" class="form-control" id="loginEmail" placeholder="邮箱">
                      <span class="tip">该邮箱尚未注册</span>
                    </div>
                    <div class="form-group">
                      <input type="password" class="form-control" id="loginPassword" placeholder="密码">
                      <span class="tip">密码错误</span>
                      
                    </div>
                    <div class="form-group" style="margin-right: 0;">
                      <button type="button" id="btnLogin" class="btn btn-primary">登录</button>
                    </div>
                    <a href="" class="findPassword">找回密码 <i class="fa fa-fw fa-angle-double-right"></i></a>
                  </form>
                </li>
              </ul>
              <ul class="nav navbar-nav navbar-left">
                <li class="subTile">寻找你的兴趣圈</li>
              </ul>
            </div>
          </div>
        </nav>
        <div class="container signUpContainer">
          <div class="row">
            <div class="col-md-4">
              <div class="nav-tabs-custom signupTab">
                  <h3 class="text-right">注册新用户</h3>
                  <div class="tab-content">
                      <div class="tab-pane active" >
                          <form action="" method="post" id="formUser">
                            <div class="row">
                              <div class="col-xs-3">
                                <label for="inviteCode">邀请码 :</label>
                              </div>
                              <div class="col-xs-9">
                                <input class="form-control" name="inviteCode" id="inviteCode" type="text" placeholder="邀请码" pattern="^[a-z,A-Z,0-9,_]{6,15}$" data-valid-min="6" required="">
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-xs-3">
                                <label for="inputName">用户名 :</label>
                              </div>
                              <div class="col-xs-9">
                                <input class="form-control" name="inputName" id="inputName" type="text" placeholder="用户名" pattern="^[a-z,A-Z,0-9,_]{6,15}$" data-valid-min="6" required="">
                              </div>
                            </div>
                            <div class="row">
                              <div class="col-xs-3">
                                <label for="inputEmail">邮箱 :</label>
                              </div>
                              <div class="col-xs-9">
                                <input class="form-control" name="inputEmail" id="inputEmail" type="email" placeholder="邮箱" required="">
                              </div>
                            </div>   
                            <div class="row" style="margin-bottom:10px;">
                              <div class="col-xs-3">
                                <label for="inputPassword">密码 :</label>
                              </div>
                              <div class="col-xs-9">
                                <input class="form-control" name="inputPassword" id="inputPassword" type="password" placeholder="密码" required="">
                              </div>
                            </div>
                            <div class="row" style="margin-bottom:0px;">
                              <div class="col-xs-3">
                                <label for="userSex">性别 :</label>
                              </div>
                              <div class="col-xs-9">
                                <div class="form-group clearfix"> 
                                    <div class="radio pull-left" style="margin-right: 15px;">
                                        <label>
                                            <input type="radio" class="inputRadio" name="userSex" id="userSex" value="Male" checked="">
                                            男
                                        </label>
                                    </div>
                                    <div class="radio pull-left">
                                        <label>
                                            <input type="radio" class="inputRadio" name="userSex" value="Female">
                                            女
                                        </label>
                                    </div>               
                                </div>
                              </div>
                            </div>
                            <div class="clearfix signupFooter">
                                <button type="submit" class="btn btn-success pull-right" id="btnRegister">立即加入</button>
                                <div class="pull-right text-right" style="width:100%; margin-top: 10px;">
                                  <a href="">获得邀请码 <i class="fa fa-fw fa-angle-double-right"></i></a>
                                </div>
                            </div>
                          </form>
                      </div>
                  </div>
              </div>
            </div>
            <div class="col-md-8">
              <div class="promoteContainer pull-right">
                <img src="/public/imgs/promote.jpg" style="width:100%;height:100%;border-radius:7px;">
              </div>
            </div>
          </div>
        </div>
        <footer class="text-center">
          <p class="">© by Joeylin 331547274@qq.com <a href="/about/feedback" target="_blank">意见与反馈</a></p>
        </footer>
        <script type="text/javascript" src="/public/js/lib/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="/public/js/lib/icheck.min.js"></script>
        <script type="text/javascript" src="/public/js/lib/bootstrap.min.js"></script>
        <script type="text/javascript" src="/public/js/lib/jquery-validate.js"></script>
        
        <script type="text/javascript">
            $('#formUser').validate({
                onkeyup: false,
                submitHandler:function(form) {
                    var data = {
                        name: $('#inputName').val(),
                        email: $('#inputEmail').val(),
                        password: $('#inputPassword').val(),
                        code: $('#inviteCode').val(),
                        sex: $('#userSex').prop('checked')? 'Male':'Female',
                        role: 'user'
                    };
                    var errorHtml = '<label class="error" id="customError"></label>';
                    $.ajax({
                        url: "/api/user/register",
                        type: "post",
                        data: data,
                        success: function (data) {
                            if (data.code == 200) {
                                $('#btnRegister').attr("disabled","disabled");
                                $('#btnRegister').text("立即加入");
                                window.location.href = '/register/step1';
                            }
                            if (data.code == 404) {
                              if (data.invite) {
                                $('#inviteCode').addClass('error').focus();
                              }
                              if (data.email) {
                                $('#inputEmail').addClass('error').focus();
                              }
                              if (data.name) {
                                $('#inputName').addClass('error').focus();
                              }
                              $('#btnRegister')
                                .text("立即加入")
                                .after($(errorHtml).text(data.info));
                            }
                            return false;
                        },
                        error: function (e) {
                            $('#btnRegister')
                              .text("立即加入")
                              .after($(errorHtml).text(data.info));
                           
                        }
                    });
                    return false;
                }
            });
            $('#inputEmail').add('#inputName').on('keydown', function() {
                $('#customError').remove();
            });
            $(".inputRadio").iCheck({
                radioClass: 'iradio_minimal'
            });
            var redirectTo = window.location.search.replace('?', '').split('=')[1];
            $('#btnLogin').on('click', function(e) {
              var email = $('#loginEmail').val();
              var password = $('#loginPassword').val();
              if (email === '') {
                $('#loginEmail').addClass('error');
                $('#loginEmail').focus();
                return false;
              }
              if (password === '') {
                $('#loginPassword').addClass('error');
                $('#loginPassword').focus();
                return false;
              }
              var data = {
                email: email,
                password: password
              };
              $.ajax({
                  url: "/api/user/login",
                  type: "post",
                  data: data,
                  success: function (data) {
                      if (data.code === 200) {
                          if (data.stage < 3) {
                            window.location.href = '/register/step' + data.stage;
                          }
                          if (redirectTo) {
                            window.location.href = redirectTo;
                          } else {
                            window.location.href = '/home';
                          }
                      } else {
                          if (data.email) {
                            $('#loginEmail').next('.tip').css({display:'inline-block'});
                            $('#loginEmail').addClass('error');
                            $('#loginEmail').focus();
                          }
                          if (data.password) {
                            $('#loginPassword').next('.tip').css({display:'inline-block'});
                            $('#loginPassword').addClass('error');
                            $('#loginPassword').focus();
                          }
                      }
                  },
                  error: function (e) {
                      $('#loginEmail').addClass('error');
                      $('#loginEmail').focus();
                  }
              });
              return false;
            });
            $('#loginEmail').add('#loginPassword').on('change keydown', function() {
              $(this).removeClass('error');
              $('#formLogin').find('.tip').css({display: 'none'});
            });
            $('#loginPassword').add('#loginEmail').on('keydown', function(e) {
              var key = e.keyCode || e.which;
              if (key === 13) {
                  $('#btnLogin').click();
              }
            });
        </script>
    </body>
</html>