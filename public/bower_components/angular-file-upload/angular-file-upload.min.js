!function(a,b){return"function"==typeof define&&define.amd?(define("angular-file-upload",["angular"],function(a){return b(a)}),void 0):b(a)}(angular||null,function(a){var b=a.module("angularFileUpload",[]);return b.directive("ngFileDrop",function(){"use strict";return{link:window.File?function(a,b,c){b.bind("drop",function(b){var d=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;b.preventDefault(),b.stopPropagation(),a.$broadcast("file:removeoverclass"),a.$emit("file:add",d.files,a.$eval(c.ngFileDrop))}).bind("dragover",function(b){var c=b.dataTransfer?b.dataTransfer:b.originalEvent.dataTransfer;b.preventDefault(),b.stopPropagation(),c.dropEffect="copy",a.$broadcast("file:addoverclass")}).bind("dragleave",function(){a.$broadcast("file:removeoverclass")})}:a.noop}}),b.directive("ngFileOver",function(){"use strict";return{link:function(a,b,c){a.$on("file:addoverclass",function(){b.addClass(c.ngFileOver||"ng-file-over")}),a.$on("file:removeoverclass",function(){b.removeClass(c.ngFileOver||"ng-file-over")})}}}),b.directive("ngFileSelect",function(){"use strict";return{link:function(a,b,c){window.File&&window.FormData||b.removeAttr("multiple"),b.bind("change",function(){a.$emit("file:add",this.files?this.files:this,a.$eval(c.ngFileSelect)),window.File&&b.prop("value",null)})}}}),b.factory("$fileUploader",["$compile","$rootScope","$http",function(b,c,d){"use strict";function e(b){a.extend(this,{scope:c,url:"/",alias:"file",queue:[],headers:{},progress:null,autoUpload:!1,removeAfterUpload:!1,filters:[],formData:[],isUploading:!1,_uploadNext:!1,_timestamp:Date.now()},b),this._observer=this.scope.$new(!0),this.filters.unshift(this._filter),this.scope.$on("file:add",function(a,b,c){a.stopPropagation(),this.addToQueue(b,c)}.bind(this)),this.bind("beforeupload",f.prototype._beforeupload),this.bind("in:progress",f.prototype._progress),this.bind("in:success",f.prototype._success),this.bind("in:error",f.prototype._error),this.bind("in:complete",f.prototype._complete),this.bind("changedqueue",this._changedQueue),this.bind("in:progress",this._progress),this.bind("in:complete",this._complete)}function f(c){if(a.isElement(c.file)){var d=a.element(c.file),e=b(d.clone())(c.uploader.scope),f=a.element('<form style="display: none;" />'),g=a.element('<iframe name="iframeTransport'+Date.now()+'">'),h=d.val();c.file={lastModifiedDate:null,size:null,type:"like/"+h.replace(/^.+\.(?!\.)|.*/,""),name:h.match(/[^\\]+$/)[0],_form:f},d.after(e).after(f),f.append(d).append(g)}a.extend(this,{progress:null,isUploading:!1,isUploaded:!1,method:"POST"},c)}return e.prototype={_filter:function(b){return a.isElement(b)?!0:!!b.size},bind:function(a,b){return this._observer.$on(this._timestamp+":"+a,b.bind(this)),this},trigger:function(a){var b=Array.prototype.slice.call(arguments,1);return b.unshift(this._timestamp+":"+a),this._observer.$emit.apply(this._observer,b),this},hasHTML5:!(!window.File||!window.FormData),addToQueue:function(b,c){var d=this.queue.length;return a.forEach("length"in b?b:[b],function(b){var d=this.filters.length?this.filters.every(function(a){return a.call(this,b)},this):!0;d&&(b=new f(a.extend({url:this.url,alias:this.alias,headers:a.copy(this.headers),formData:a.copy(this.formData),removeAfterUpload:this.removeAfterUpload,uploader:this,file:b},c)),this.queue.push(b),this.trigger("afteraddingfile",b))},this),this.queue.length!==d&&(this.trigger("afteraddingall",this.queue),this.trigger("changedqueue",this.queue)),this.autoUpload&&this.uploadAll(),this},removeFromQueue:function(b){var c=a.isObject(b)?this.getIndexOfItem(b):b,d=this.queue.splice(c,1)[0];return d.file&&d.file._form&&d.file._form.remove(),this.trigger("changedqueue",d),this},clearQueue:function(){return a.forEach(this.queue,function(a){a.file._form&&a.file._form.remove()},this),this.queue.length=0,this.trigger("changedqueue",this.queue),this},getIndexOfItem:function(a){return this.queue.indexOf(a)},getNotUploadedItems:function(){return this.queue.filter(function(a){return!a.isUploaded})},uploadItem:function(b){if(this.isUploading)return this;var c=a.isObject(b)?this.getIndexOfItem(b):b,d=this.queue[c],e=d.file._form?"_iframeTransport":"_xhrTransport";return this.isUploading=!0,this[e](d),this},uploadAll:function(){var a=this.getNotUploadedItems()[0];return this._uploadNext=!!a,this._uploadNext&&this.uploadItem(a),this},_getTotalProgress:function(a){if(this.removeAfterUpload)return a||0;var b=this.getNotUploadedItems().length,c=b?this.queue.length-b:this.queue.length,d=100/this.queue.length,e=(a||0)*d/100;return Math.round(c*d+e)},_progress:function(a,b,c){var d=this._getTotalProgress(c);this.progress=d,this.trigger("progressall",d),this.scope.$$phase||this.scope.$apply()},_complete:function(){this.isUploading=!1,this._uploadNext&&this.uploadAll(),this._uploadNext||this.trigger("completeall",this.queue),this._uploadNext&&this.scope.$$phase||this.scope.$apply()},_changedQueue:function(){this.progress=this._getTotalProgress(),this.scope.$$phase||this.scope.$apply()},_xhrTransport:function(b){var c=new XMLHttpRequest,d=new FormData,e=this;this.trigger("beforeupload",b),a.forEach(b.formData,function(b){a.forEach(b,function(a,b){d.append(b,a)})}),d.append(b.alias,b.file),c.upload.addEventListener("progress",function(a){var c=a.lengthComputable?100*a.loaded/a.total:0;e.trigger("in:progress",b,Math.round(c))},!1),c.addEventListener("load",function(){var a=e._transformResponse(c.response),d=~[200,201].indexOf(c.status)?"in:success":"in:error";e.trigger(d,c,b,a),e.trigger("in:complete",c,b,a)},!1),c.addEventListener("error",function(){e.trigger("in:error",c,b),e.trigger("in:complete",c,b)},!1),c.addEventListener("abort",function(){e.trigger("in:complete",c,b)},!1),c.open(b.method,b.url,!0),a.forEach(b.headers,function(a,b){c.setRequestHeader(b,a)}),c.send(d)},_iframeTransport:function(b){var c=b.file._form,d=c.find("iframe"),e=c.find("input"),f=this;this.trigger("beforeupload",b),a.forEach(e,function(b){"file"!==b.type&&a.element(b).remove()}),e.prop("name",b.alias),a.forEach(b.formData,function(b){a.forEach(b,function(b,d){c.append(a.element('<input type="hidden" name="'+d+'" value="'+b+'" />'))})}),c.prop({action:b.url,method:b.method,target:d.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),d.unbind().bind("load",function(){var a={response:d.contents()[0].body.innerHTML,status:200,dummy:!0},c=f._transformResponse(a.response);f.trigger("in:complete",a,b,c)}),c[0].submit()},_transformResponse:function(b){return a.forEach(d.defaults.transformResponse,function(a){b=a(b)}),b}},f.prototype={remove:function(){this.uploader.removeFromQueue(this)},upload:function(){this.uploader.uploadItem(this)},_beforeupload:function(a,b){b.isUploaded=!1,b.isUploading=!0,b.progress=null},_progress:function(a,b,c){b.progress=c,b.uploader.trigger("progress",b,c)},_success:function(a,b,c,d){c.isUploaded=!0,c.isUploading=!1,c.uploader.trigger("success",b,c,d)},_error:function(a,b,c,d){c.isUploaded=!0,c.isUploading=!1,c.uploader.trigger("error",b,c,d)},_complete:function(a,b,c,d){c.isUploaded=!0,c.isUploading=!1,c.uploader.trigger("complete",b,c,d),c.removeAfterUpload&&c.remove()}},{create:function(a){return new e(a)}}}]),b});
//# sourceMappingURL=angular-file-upload.min.map